# Retriever êµ¬í˜„ ê°€ì´ë“œ

## ê°œìš”

RAG ì‹œìŠ¤í…œì˜ í•µì‹¬ êµ¬ì„± ìš”ì†Œì¸ ê²€ìƒ‰ê¸°(Retriever)ë¥¼ êµ¬í˜„í•œ ë¬¸ì„œì…ë‹ˆë‹¤. ë²¡í„° ê²€ìƒ‰, í‚¤ì›Œë“œ ê²€ìƒ‰, í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰, ë¦¬ë­í‚¹ ê¸°ëŠ¥ì„ ëª¨ë‘ í¬í•¨í•©ë‹ˆë‹¤.

**êµ¬í˜„ ë‚ ì§œ:** 2026-02-07  
**êµ¬í˜„ íŒŒì¼:** `app/retriever.py`  
**í…ŒìŠ¤íŠ¸ íŒŒì¼:** `test_retriever.py`

---

## 1. í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (Hybrid Search)

### ê°œë…

ë²¡í„° ê²€ìƒ‰(Semantic Search)ê³¼ í‚¤ì›Œë“œ ê²€ìƒ‰(Lexical Search)ì„ ê²°í•©í•˜ì—¬ ë” ì •í™•í•œ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì–»ëŠ” ê¸°ë²•ì…ë‹ˆë‹¤.

### ë‘ ê°€ì§€ ê²€ìƒ‰ ë°©ì‹ ë¹„êµ

#### ğŸ§  ë²¡í„° ê²€ìƒ‰ (Semantic Search)

**ì‘ë™ ì›ë¦¬:**
```python
query = "5G í†µì‹  ê¸°ìˆ "
# â†’ "ì°¨ì„¸ëŒ€ ì´ë™í†µì‹ ", "ë¬´ì„  ê´‘ëŒ€ì—­" ë“±ë„ ê²€ìƒ‰ë¨
```

**ì¥ì :**
- ì˜ë¯¸ì ìœ¼ë¡œ ìœ ì‚¬í•œ ë‚´ìš© ê²€ìƒ‰
- ë™ì˜ì–´, ìœ ì‚¬ì–´ ìë™ ì¸ì‹
- ë¬¸ë§¥ ì´í•´

**ë‹¨ì :**
- ì •í™•í•œ ìš©ì–´ ë§¤ì¹­ ë¶€ì¡±
- ê³ ìœ ëª…ì‚¬ë‚˜ ì•½ì–´ ê²€ìƒ‰ ì•½í•¨
- "5G"ì™€ "4G" êµ¬ë¶„ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ

#### ğŸ”¤ í‚¤ì›Œë“œ ê²€ìƒ‰ (BM25)

**ì‘ë™ ì›ë¦¬:**
```python
query = "VoLTE"
# â†’ "VoLTE"ë¼ëŠ” ì •í™•í•œ ë‹¨ì–´ê°€ í¬í•¨ëœ ë¬¸ì„œë§Œ ê²€ìƒ‰
```

**ì¥ì :**
- ì •í™•í•œ ë‹¨ì–´ ë§¤ì¹­
- ê³ ìœ ëª…ì‚¬, ê¸°ìˆ ìš©ì–´ ê²€ìƒ‰ ìš°ìˆ˜
- ë¹ ë¥¸ ì†ë„

**ë‹¨ì :**
- ë™ì˜ì–´ ì¸ì‹ ë¶ˆê°€
- ë¬¸ë§¥ ì´í•´ ë¶€ì¡±
- "VoLTE" â‰  "Voice over LTE"

### í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ êµ¬í˜„

ë‘ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê²°í•©í•˜ëŠ” ë‘ ê°€ì§€ ë°©ë²•:

#### 1. Weighted (ê°€ì¤‘ì¹˜ ë°©ì‹)

```python
# ì •ê·œí™”ëœ ì ìˆ˜ì— ê°€ì¤‘ì¹˜ ì ìš©
combined_score = alpha * vector_score + (1 - alpha) * bm25_score

# ì˜ˆ: alpha=0.7ì´ë©´ ë²¡í„°:BM25 = 7:3
```

**íŠ¹ì§•:**
- ì ìˆ˜ë¥¼ 0-1ë¡œ ì •ê·œí™” í›„ ê²°í•©
- ê°€ì¤‘ì¹˜(alpha)ë¡œ ë¹„ìœ¨ ì¡°ì • ê°€ëŠ¥
- ì§ê´€ì ì´ê³  ì´í•´í•˜ê¸° ì‰¬ì›€

#### 2. RRF (Reciprocal Rank Fusion)

```python
# ìˆœìœ„ ê¸°ë°˜ ì ìˆ˜ ê³„ì‚°
rrf_score = 1 / (k + rank + 1)

# ì˜ˆ: k=60ì¼ ë•Œ
# 1ìœ„: 1/61 = 0.0164
# 2ìœ„: 1/62 = 0.0161
```

**íŠ¹ì§•:**
- ì ˆëŒ€ ì ìˆ˜ê°€ ì•„ë‹Œ ìˆœìœ„ë§Œ ì‚¬ìš©
- ê°€ì¤‘ì¹˜ ì¡°ì • ë¶ˆí•„ìš”
- ì„œë¡œ ë‹¤ë¥¸ ì²™ë„ì˜ ì ìˆ˜ ê²°í•©ì— ìœ ë¦¬

---

## 2. ë¦¬ë­í‚¹ (Re-ranking)

### ê°œë…

ì´ˆê¸° ê²€ìƒ‰ ê²°ê³¼(ì˜ˆ: ìƒìœ„ 20ê°œ)ë¥¼ ë” ì •í™•í•œ ë°©ë²•ìœ¼ë¡œ ì¬ì •ë ¬í•˜ì—¬ ìµœì¢… ê²°ê³¼(ì˜ˆ: ìƒìœ„ 5ê°œ)ì˜ í’ˆì§ˆì„ í–¥ìƒì‹œí‚¤ëŠ” ê¸°ë²•ì…ë‹ˆë‹¤.

### ë¦¬ë­í‚¹ í”„ë¡œì„¸ìŠ¤

```
1ï¸âƒ£ ì´ˆê¸° ê²€ìƒ‰ (ë¹ ë¥´ì§€ë§Œ ëœ ì •í™•)
   â†“ ìƒìœ„ 20-100ê°œ í›„ë³´ ì¶”ì¶œ
   
2ï¸âƒ£ ë¦¬ë­í‚¹ (ëŠë¦¬ì§€ë§Œ ë” ì •í™•)
   â†“ ì •ë°€í•œ ì¬ì •ë ¬
   
3ï¸âƒ£ ìµœì¢… ê²°ê³¼
   â†’ ìƒìœ„ 5-10ê°œ ì •ì œëœ ê²°ê³¼
```

### ë¦¬ë­í‚¹ ë°©ë²•

#### BM25 ì¬ê³„ì‚°

```python
# ì´ˆê¸° ê²€ìƒ‰ í›„ë³´ì— ëŒ€í•´ BM25 ì ìˆ˜ ì¬ê³„ì‚°
bm25 = BM25Okapi(tokenized_docs)
scores = bm25.get_scores(tokenized_query)
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- ë²¡í„° ê²€ìƒ‰ìœ¼ë¡œ ì˜ë¯¸ì  í›„ë³´ ì¶”ì¶œ
- BM25ë¡œ í‚¤ì›Œë“œ ì •í™•ë„ ê²€ì¦
- ê¸°ìˆ  ë¬¸ì„œì—ì„œ íŠ¹íˆ íš¨ê³¼ì 

---

## 3. êµ¬í˜„ëœ í´ë˜ìŠ¤

### í´ë˜ìŠ¤ ê³„ì¸µ êµ¬ì¡°

```
BaseRetriever (ì¶”ìƒ í´ë˜ìŠ¤)
â”œâ”€â”€ VectorRetriever (ë²¡í„° ê²€ìƒ‰)
â”œâ”€â”€ BM25Retriever (í‚¤ì›Œë“œ ê²€ìƒ‰)
â”œâ”€â”€ HybridRetriever (í•˜ì´ë¸Œë¦¬ë“œ)
â””â”€â”€ AdvancedRetriever (í•˜ì´ë¸Œë¦¬ë“œ + ë¦¬ë­í‚¹)
```

### 3.1 VectorRetriever

**ê¸°ëŠ¥:** ë²¡í„° ìœ ì‚¬ë„ ê¸°ë°˜ ê²€ìƒ‰

```python
retriever = VectorRetriever()
results = retriever.search("5G voice call quality", k=5)
```

**íŠ¹ì§•:**
- Ollama ì„ë² ë”© ëª¨ë¸ ì‚¬ìš©
- ChromaDB ë²¡í„° ì €ì¥ì†Œ í™œìš©
- ì˜ë¯¸ì  ìœ ì‚¬ë„ë¡œ ê²€ìƒ‰

### 3.2 BM25Retriever

**ê¸°ëŠ¥:** BM25 ì•Œê³ ë¦¬ì¦˜ ê¸°ë°˜ í‚¤ì›Œë“œ ê²€ìƒ‰

```python
retriever = BM25Retriever()
results = retriever.search("VoLTE interoperability", k=5)
```

**íŠ¹ì§•:**
- `rank-bm25` ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
- ë²¡í„° ì €ì¥ì†Œì—ì„œ ë¬¸ì„œ ë¡œë“œ í›„ ì¸ë±ìŠ¤ êµ¬ì¶•
- ì •í™•í•œ í‚¤ì›Œë“œ ë§¤ì¹­

**ì£¼ìš” ë©”ì„œë“œ:**
- `_build_index()`: BM25 ì¸ë±ìŠ¤ êµ¬ì¶•
- `rebuild_index()`: ì¸ë±ìŠ¤ ì¬êµ¬ì¶•
- `search()`: BM25 ê²€ìƒ‰ ìˆ˜í–‰

### 3.3 HybridRetriever

**ê¸°ëŠ¥:** ë²¡í„° + BM25 í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰

```python
# Weighted ë°©ì‹
retriever = HybridRetriever(alpha=0.7, fusion_method="weighted")

# RRF ë°©ì‹
retriever = HybridRetriever(alpha=0.7, fusion_method="rrf")

results = retriever.search("5G VoLTE quality testing", k=5)
```

**íŒŒë¼ë¯¸í„°:**
- `alpha`: ë²¡í„° ê²€ìƒ‰ ê°€ì¤‘ì¹˜ (0~1, ê¸°ë³¸ê°’ 0.7)
- `fusion_method`: "weighted" ë˜ëŠ” "rrf"

**íŠ¹ì§•:**
- ë‘ ê²€ìƒ‰ ë°©ë²•ì˜ ì¥ì  ê²°í•©
- ì˜ë¯¸ ì´í•´ + í‚¤ì›Œë“œ ì •í™•ë„
- ë” ë§ì€ í›„ë³´(k*3) ì¶”ì¶œ í›„ ê²°í•©

### 3.4 AdvancedRetriever

**ê¸°ëŠ¥:** í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ + ë¦¬ë­í‚¹

```python
retriever = AdvancedRetriever(
    alpha=0.7,
    fusion_method="rrf",
    rerank_method="bm25",
    use_rerank=True
)

results = retriever.search("5G interoperability test", k=5)
```

**íŒŒë¼ë¯¸í„°:**
- `alpha`: í•˜ì´ë¸Œë¦¬ë“œ ê°€ì¤‘ì¹˜
- `fusion_method`: ê²°í•© ë°©ì‹
- `rerank_method`: ë¦¬ë­í‚¹ ë°©ë²• ("bm25", "score")
- `use_rerank`: ë¦¬ë­í‚¹ ì‚¬ìš© ì—¬ë¶€

**í”„ë¡œì„¸ìŠ¤:**
1. í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ìœ¼ë¡œ k*4ê°œ í›„ë³´ ì¶”ì¶œ
2. BM25ë¡œ ì¬ì •ë ¬
3. ìƒìœ„ kê°œ ë°˜í™˜

### 3.5 Reranker

**ê¸°ëŠ¥:** ê²€ìƒ‰ ê²°ê³¼ ì¬ì •ë ¬

```python
reranker = Reranker(method="bm25")
reranked = reranker.rerank(query, initial_results, top_k=5)
```

**íŠ¹ì§•:**
- ë…ë¦½ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥
- BM25 ë˜ëŠ” ê¸°ì¡´ ì ìˆ˜ ê¸°ë°˜ ì¬ì •ë ¬

---

## 4. SearchResult í´ë˜ìŠ¤

ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë°ì´í„° í´ë˜ìŠ¤:

```python
class SearchResult:
    id: str              # ë¬¸ì„œ ì²­í¬ ID
    content: str         # ë¬¸ì„œ ë‚´ìš©
    score: float         # ìœ ì‚¬ë„ ì ìˆ˜
    metadata: Dict       # ë©”íƒ€ë°ì´í„°
```

**ë©”ì„œë“œ:**
- `to_dict()`: ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜
- `__repr__()`: ë¬¸ìì—´ í‘œí˜„

---

## 5. íŒ©í† ë¦¬ í•¨ìˆ˜

### create_retriever()

ë‹¤ì–‘í•œ íƒ€ì…ì˜ ê²€ìƒ‰ê¸°ë¥¼ ìƒì„±í•˜ëŠ” íŒ©í† ë¦¬ í•¨ìˆ˜:

```python
# ë²¡í„° ê²€ìƒ‰ë§Œ
retriever = create_retriever("vector")

# BM25 ê²€ìƒ‰ë§Œ
retriever = create_retriever("bm25")

# í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰
retriever = create_retriever("hybrid", alpha=0.7, fusion_method="rrf")

# ê³ ê¸‰ ê²€ìƒ‰ (í•˜ì´ë¸Œë¦¬ë“œ + ë¦¬ë­í‚¹)
retriever = create_retriever("advanced", alpha=0.7, use_rerank=True)
```

### get_retriever()

ê¸°ë³¸ ê²€ìƒ‰ê¸° ë°˜í™˜ (í¸ì˜ í•¨ìˆ˜):

```python
# ê¸°ë³¸ê°’: advanced ê²€ìƒ‰ê¸°
retriever = get_retriever()

# íƒ€ì… ì§€ì •
retriever = get_retriever("hybrid", alpha=0.6)
```

---

## 6. í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„

### í…ŒìŠ¤íŠ¸ êµ¬ì„±

`test_retriever.py`ì—ì„œ 8ê°œ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰:

1. âœ… ë²¡í„° ê²€ìƒ‰
2. âœ… BM25 ê²€ìƒ‰
3. âœ… í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (Weighted)
4. âœ… í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (RRF)
5. âœ… ë¦¬ë­í‚¹
6. âœ… ê³ ê¸‰ ê²€ìƒ‰ê¸°
7. âœ… ê²€ìƒ‰ ë°©ë²• ë¹„êµ
8. âœ… íŒ©í† ë¦¬ í•¨ìˆ˜

### ì£¼ìš” í…ŒìŠ¤íŠ¸ ê²°ê³¼

#### ì¿¼ë¦¬: "VoLTE 5G voice quality"

| ê²€ìƒ‰ ë°©ë²• | 1ìœ„ ë¬¸ì„œ | ì ìˆ˜ | íŠ¹ì§• |
|----------|----------|------|------|
| ë²¡í„° | VoLTE enables... | 0.7448 | ì˜ë¯¸ ìœ ì‚¬ì„± |
| BM25 | VoLTE enables... | 3.3361 | í‚¤ì›Œë“œ ì •í™•ë„ â¬†ï¸ |
| í•˜ì´ë¸Œë¦¬ë“œ(RRF) | VoLTE enables... | 0.0328 | ê· í˜• ì¡íŒ ìˆœìœ„ |
| ê³ ê¸‰(+ë¦¬ë­í‚¹) | VoLTE enables... | 3.3361 | ìµœì¢… ì •ë°€ë„ â¬†ï¸ |

**ì¸ì‚¬ì´íŠ¸:**
- ëª¨ë“  ë°©ë²•ì´ ê°™ì€ ë¬¸ì„œë¥¼ 1ìœ„ë¡œ ì„ íƒ âœ…
- ì ìˆ˜ ì ˆëŒ€ê°’ì€ ì²™ë„ê°€ ë‹¬ë¼ ì§ì ‘ ë¹„êµ ë¶ˆê°€
- ìˆœì„œëŠ” ì¼ê´€ë¨: #2 â†’ #3 â†’ #9

#### ì¿¼ë¦¬: "femtocell small cell deployment"

**ì´ˆê¸° ê²€ìƒ‰ (ë²¡í„°):**
```
1ìœ„: test_doc_5 (0.8075) - The 5G femtocell provides...
2ìœ„: test_doc_1 (0.6529) - 5G technology operates...
```

**ë¦¬ë­í‚¹ í›„ (BM25):**
```
1ìœ„: test_doc_5 (3.2813) âœ… ìœ ì§€
2~5ìœ„: (0.0000) - í‚¤ì›Œë“œ ì—†ìŒ
```

**íš¨ê³¼:**
- í‚¤ì›Œë“œê°€ ì •í™•íˆ í¬í•¨ëœ ë¬¸ì„œê°€ í™•ì‹¤íˆ 1ìœ„
- ê´€ë ¨ ì—†ëŠ” ë¬¸ì„œëŠ” ì ìˆ˜ 0ìœ¼ë¡œ í•˜ë½
- ë¦¬ë­í‚¹ì´ ë…¸ì´ì¦ˆ ì œê±° ì—­í• 

---

## 7. ì‹¤ì „ í™œìš© ê°€ì´ë“œ

### ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ë³„ ì¶”ì²œ

| ìƒí™© | ì¶”ì²œ ë°©ë²• | ì´ìœ  |
|-----|----------|------|
| ì •í™•í•œ ê¸°ìˆ ìš©ì–´ ê²€ìƒ‰ | BM25 | "VoLTE", "5G SA" ë“± ì •í™•í•œ ë§¤ì¹­ |
| ê°œë…/ì£¼ì œ ê²€ìƒ‰ | ë²¡í„° | "ìŒì„±í†µí™” í’ˆì§ˆ" â†’ VoLTE ë¬¸ì„œ |
| ì¼ë°˜ì ì¸ RAG | **í•˜ì´ë¸Œë¦¬ë“œ** | í‚¤ì›Œë“œ + ì˜ë¯¸ ëª¨ë‘ ê³ ë ¤ |
| ë†’ì€ ì •í™•ë„ í•„ìš” | **ê³ ê¸‰(+ë¦¬ë­í‚¹)** | ìµœê³  í’ˆì§ˆ, ì•½ê°„ ëŠë¦¼ |

### ê¶Œì¥ ì„¤ì •

#### ê¸°ë³¸ ì‚¬ìš© (ê· í˜•)

```python
retriever = get_retriever("advanced", alpha=0.7, fusion_method="rrf")
results = retriever.search(query, k=5)
```

#### í‚¤ì›Œë“œ ì¤‘ìš” (ê¸°ìˆ  ë¬¸ì„œ)

```python
retriever = get_retriever("advanced", alpha=0.5)  # BM25 ë¹„ì¤‘ 50%
```

#### ì˜ë¯¸ ì¤‘ìš” (ìì—°ì–´ ì§ˆë¬¸)

```python
retriever = get_retriever("advanced", alpha=0.9)  # ë²¡í„° ë¹„ì¤‘ 90%
```

#### ë¹ ë¥¸ ê²€ìƒ‰ í•„ìš”

```python
retriever = get_retriever("hybrid", use_rerank=False)
```

---

## 8. ì„±ëŠ¥ ë¹„êµ

### ì •í™•ë„

```
ê³ ê¸‰ (í•˜ì´ë¸Œë¦¬ë“œ+ë¦¬ë­í‚¹) > í•˜ì´ë¸Œë¦¬ë“œ > ë²¡í„°/BM25 ë‹¨ë…
```

### ì†ë„

```
ë²¡í„° â‰ˆ BM25 > í•˜ì´ë¸Œë¦¬ë“œ > ê³ ê¸‰
```

### ë²”ìš©ì„±

```
í•˜ì´ë¸Œë¦¬ë“œ > ë²¡í„°/BM25 ë‹¨ë…
```

---

## 9. ì˜ì¡´ì„±

### í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬

```txt
# requirements.txtì— ì¶”ê°€ë¨
rank-bm25>=0.2.2
numpy>=1.24.0
```

### ì„¤ì¹˜

```bash
pip install rank-bm25 numpy
```

---

## 10. ì‚¬ìš© ì˜ˆì œ

### ì˜ˆì œ 1: ê¸°ë³¸ ê²€ìƒ‰

```python
from app.retriever import get_retriever

# ê²€ìƒ‰ê¸° ìƒì„±
retriever = get_retriever("advanced")

# ê²€ìƒ‰ ìˆ˜í–‰
query = "5G VoLTE interoperability testing"
results = retriever.search(query, k=5)

# ê²°ê³¼ ì¶œë ¥
for i, result in enumerate(results, 1):
    print(f"{i}. [{result.score:.4f}] {result.content[:100]}...")
```

### ì˜ˆì œ 2: ì»¤ìŠ¤í…€ ì„¤ì •

```python
from app.retriever import AdvancedRetriever
from app.vector_store import get_vector_store

# ë²¡í„° ì €ì¥ì†Œ
store = get_vector_store()

# ì»¤ìŠ¤í…€ ê²€ìƒ‰ê¸°
retriever = AdvancedRetriever(
    vector_store=store,
    alpha=0.6,                 # ë²¡í„° 60%, BM25 40%
    fusion_method="rrf",       # RRF ê²°í•©
    rerank_method="bm25",      # BM25 ë¦¬ë­í‚¹
    use_rerank=True            # ë¦¬ë­í‚¹ í™œì„±í™”
)

results = retriever.search("VoLTE quality", k=10)
```

### ì˜ˆì œ 3: ê°œë³„ ê²€ìƒ‰ê¸° ì¡°í•©

```python
from app.retriever import VectorRetriever, BM25Retriever, Reranker

# 1. ë²¡í„° ê²€ìƒ‰ìœ¼ë¡œ í›„ë³´ ì¶”ì¶œ
vector_retriever = VectorRetriever()
candidates = vector_retriever.search(query, k=20)

# 2. ë¦¬ë­í‚¹ìœ¼ë¡œ ì •ì œ
reranker = Reranker(method="bm25")
final_results = reranker.rerank(query, candidates, top_k=5)
```

---

## 11. êµ¬í˜„ ì‹œ ì£¼ì˜ì‚¬í•­

### BM25 ì¸ë±ìŠ¤ ê´€ë¦¬

```python
# ë¬¸ì„œê°€ ì¶”ê°€/ì‚­ì œëœ ê²½ìš° ì¸ë±ìŠ¤ ì¬êµ¬ì¶• í•„ìš”
bm25_retriever.rebuild_index()
```

### ë©”ëª¨ë¦¬ ì‚¬ìš©

- BM25ëŠ” ëª¨ë“  ë¬¸ì„œë¥¼ ë©”ëª¨ë¦¬ì— ë¡œë“œ
- ëŒ€ìš©ëŸ‰ ë¬¸ì„œ ì§‘í•©ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€
- í•„ìš”ì‹œ ë°°ì¹˜ ì²˜ë¦¬ ê³ ë ¤

### ì ìˆ˜ í•´ì„

- ë²¡í„°: 0~1 (ì½”ì‚¬ì¸ ìœ ì‚¬ë„)
- BM25: 0~ë¬´í•œëŒ€ (TF-IDF ê¸°ë°˜)
- RRF: 0~0.033 ì •ë„ (ìˆœìœ„ ì—­ìˆ˜)
- **ì ˆëŒ€ê°’ ë¹„êµ ë¶ˆê°€, ìˆœìœ„ë§Œ ì˜ë¯¸ ìˆìŒ**

---

## 12. í–¥í›„ ê°œì„  ë°©í–¥

### ì„ íƒì  ê³ ê¸‰ ê¸°ëŠ¥

1. **Cross-Encoder ë¦¬ë­í‚¹**
   ```python
   from sentence_transformers import CrossEncoder
   
   # ë” ì •í™•í•˜ì§€ë§Œ ëŠë¦¼
   model = CrossEncoder('cross-encoder/ms-marco-MiniLM-L-6-v2')
   ```

2. **ì¿¼ë¦¬ í™•ì¥ (Query Expansion)**
   - LLMìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ í™•ì¥
   - ë™ì˜ì–´ ì¶”ê°€

3. **ë©”íƒ€ë°ì´í„° í•„í„°ë§**
   ```python
   results = retriever.search(
       query,
       filter={"source": "5G_specs"}
   )
   ```

---

## 13. í…ŒìŠ¤íŠ¸ ì‹¤í–‰

### Docker ì»¨í…Œì´ë„ˆì—ì„œ ì‹¤í–‰

```bash
docker compose exec -T markitdown-api python test_retriever.py
```

### ë¡œì»¬ì—ì„œ ì‹¤í–‰

```bash
python test_retriever.py
```

### ì˜ˆìƒ ì¶œë ¥

```
======================================================================
  Retriever ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ ì‹œì‘
======================================================================

âœ“ í…ŒìŠ¤íŠ¸ 1: ë²¡í„° ê²€ìƒ‰ í†µê³¼
âœ“ í…ŒìŠ¤íŠ¸ 2: BM25 í‚¤ì›Œë“œ ê²€ìƒ‰ í†µê³¼
âœ“ í…ŒìŠ¤íŠ¸ 3: í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (Weighted) í†µê³¼
âœ“ í…ŒìŠ¤íŠ¸ 4: í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (RRF) í†µê³¼
âœ“ í…ŒìŠ¤íŠ¸ 5: ë¦¬ë­í‚¹ í†µê³¼
âœ“ í…ŒìŠ¤íŠ¸ 6: ê³ ê¸‰ ê²€ìƒ‰ê¸° í†µê³¼
âœ“ í…ŒìŠ¤íŠ¸ 7: ê²€ìƒ‰ ë°©ë²• ë¹„êµ ì™„ë£Œ
âœ“ í…ŒìŠ¤íŠ¸ 8: íŒ©í† ë¦¬ í•¨ìˆ˜ í†µê³¼

âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ í†µê³¼í–ˆìŠµë‹ˆë‹¤!
```

---

## 14. ë‹¤ìŒ ë‹¨ê³„: RAG íŒŒì´í”„ë¼ì¸

Retriever êµ¬í˜„ì´ ì™„ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ ë‹¤ìŒì€ `rag.py` êµ¬í˜„:

```python
# rag.py êµ¬ì¡° (ì˜ˆì •)
class RAGPipeline:
    def __init__(self):
        self.retriever = get_retriever("advanced")
        self.llm_client = get_ollama_client()
    
    def query(self, question: str) -> str:
        # 1. ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰
        docs = self.retriever.search(question, k=5)
        
        # 2. ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
        context = self._build_context(docs)
        
        # 3. LLMìœ¼ë¡œ ë‹µë³€ ìƒì„±
        answer = self.llm_client.generate(question, context)
        
        return answer
```

---

## 15. ì°¸ê³  ìë£Œ

### ë…¼ë¬¸ ë° ë¬¸ì„œ

- [BM25 ì•Œê³ ë¦¬ì¦˜](https://en.wikipedia.org/wiki/Okapi_BM25)
- [Reciprocal Rank Fusion](https://plg.uwaterloo.ca/~gvcormac/cormacksigir09-rrf.pdf)
- [Hybrid Search in RAG Systems](https://arxiv.org/abs/2005.11401)

### ë¼ì´ë¸ŒëŸ¬ë¦¬

- [rank-bm25](https://github.com/dorianbrown/rank_bm25)
- [ChromaDB](https://docs.trychroma.com/)
- [Ollama](https://ollama.ai/)

---

## ìš”ì•½

### âœ… êµ¬í˜„ ì™„ë£Œ

- **VectorRetriever**: ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰
- **BM25Retriever**: í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰
- **HybridRetriever**: ë‘ ë°©ë²• ê²°í•© (Weighted/RRF)
- **AdvancedRetriever**: í•˜ì´ë¸Œë¦¬ë“œ + ë¦¬ë­í‚¹
- **Reranker**: ê²°ê³¼ ì¬ì •ë ¬
- **íŒ©í† ë¦¬ í•¨ìˆ˜**: í¸ë¦¬í•œ ê²€ìƒ‰ê¸° ìƒì„±

### ğŸ¯ í•µì‹¬ íŠ¹ì§•

1. **ìœ ì—°ì„±**: 4ê°€ì§€ ê²€ìƒ‰ ë°©ë²• ì„ íƒ ê°€ëŠ¥
2. **ì •í™•ë„**: í•˜ì´ë¸Œë¦¬ë“œ + ë¦¬ë­í‚¹ìœ¼ë¡œ ìµœê³  í’ˆì§ˆ
3. **í™•ì¥ì„±**: ìƒˆë¡œìš´ ê²€ìƒ‰ ë°©ë²• ì¶”ê°€ ìš©ì´
4. **í…ŒìŠ¤íŠ¸**: 8ê°œ í…ŒìŠ¤íŠ¸ë¡œ ëª¨ë“  ê¸°ëŠ¥ ê²€ì¦

### ğŸ“Š ì„±ëŠ¥

- **ì •í™•ë„**: â­â­â­â­â­ (ê³ ê¸‰ ê²€ìƒ‰ê¸°)
- **ì†ë„**: â­â­â­â­ (ë¦¬ë­í‚¹ì´ ì•½ê°„ ì¶”ê°€ ì‹œê°„)
- **ì‚¬ìš©ì„±**: â­â­â­â­â­ (íŒ©í† ë¦¬ í•¨ìˆ˜ë¡œ ê°„í¸)

**ë‹¤ìŒ:** `rag.py` êµ¬í˜„ìœ¼ë¡œ ì „ì²´ RAG íŒŒì´í”„ë¼ì¸ ì™„ì„±
